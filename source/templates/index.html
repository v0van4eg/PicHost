<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PicHost ‚Äî –•–æ—Å—Ç–∏–Ω–≥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/index.css') }}">
</head>
<body data-can-upload="{{ 'true' if has_permission(Permissions.UPLOAD_ZIP) else 'false' }}"
      data-can-manage-albums="{{ 'true' if has_permission(Permissions.MANAGE_ALBUMS) else 'false' }}"
      data-can-manage-articles="{{ 'true' if has_permission(Permissions.MANAGE_ARTICLES) else 'false' }}"
      data-can-export="{{ 'true' if has_permission(Permissions.EXPORT_DATA) else 'false' }}"
      data-can-view-files="{{ 'true' if has_permission(Permissions.VIEW_FILES) else 'false' }}"
      data-can-view-stats="{{ 'true' if has_permission(Permissions.SYNC_DATABASE) else 'false' }}">
    <div class="container">
        <header style="display: flex; justify-content: center; align-items: center; position: relative;">
            <div style="text-align: center;">
                <h2>üìÅ PicHost ‚Äî –•–æ—Å—Ç–∏–Ω–≥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</h2>
            </div>
            <div style="position: absolute; right: 20px; background: #f8f9fa; padding: 6px 12px; border-radius: 6px; border: 1px solid #dee2e6; font-size: 0.85rem;">
                <div class="user-info">
                        <a href="/profile" style="text-decoration: none; color: inherit;">
                            <span>üë§ {{ (current_user.given_name + ' ' + current_user.family_name)|trim or current_user.name }}</span>
                            {% if is_appviewer_by_default %}
                                <span title="–†–æ–ª—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏" style="color: #e67e22; margin-left: 5px;">‚ö°</span>
                            {% endif %}
                        </a>
                        | <a href="/logout" style="color: red">–í—ã–π—Ç–∏</a>
                </div>
            </div>
        </header>
        <div class="columns">
            <div class="column-left">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–æ UPLOAD_ZIP -->
                <div class="card" id="uploadCard"
                     {% if not has_permission(Permissions.UPLOAD_ZIP) %}style="display: none;"{% endif %}>
                    <h2>üì§ –ó–∞–≥—Ä—É–∑–∏—Ç–µ ZIP-–∞—Ä—Ö–∏–≤</h2>
                    <form id="uploadForm" enctype="multipart/form-data"
                          {% if not has_permission(Permissions.UPLOAD_ZIP) %}style="display: none;"{% endif %}>
                        <div class="upload-area" id="dropArea">
                            <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ ZIP-–∞—Ä—Ö–∏–≤ —Å—é–¥–∞</p>
                            <p>–∏–ª–∏</p>
                            <button type="button" class="btn" id="browseBtn">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>
                            <input type="file" id="zipFile" name="zipfile" accept=".zip" class="file-input">
                        </div>

                        <button type="submit" class="btn" id="uploadBtn" disabled
                                {% if not has_permission(Permissions.UPLOAD_ZIP) %}style="display: none;"{% endif %}>
                            <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—Ä—Ö–∏–≤</span>
                        </button>

                        {% if not has_permission(Permissions.UPLOAD_ZIP) %}
                        <div style="text-align: center; padding: 10px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px; margin-top: 10px;">
                            <p style="margin: 0; color: #856404;">‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤</p>
                            <p style="margin: 5px 0 0 0; font-size: 0.9rem; color: #856404;">
                                –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤
                            </p>
                        </div>
                        {% endif %}

                        <div id="progressContainer">
                            <div id="progressBar">
                                <span id="progressText">0%</span>
                            </div>
                        </div>
                    </form>
                    
                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                    <hr>
                    <div id="uploadImageCard">
                        <h2>üñºÔ∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h2>
                        <form id="uploadImageForm" enctype="multipart/form-data">
                            <div class="upload-area" id="imageDropArea">
                                <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—é–¥–∞</p>
                                <p>–∏–ª–∏</p>
                                <button type="button" class="btn" id="imageBrowseBtn">–í—ã–±—Ä–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</button>
                                <input type="file" id="imageFile" name="image" accept="image/*" class="file-input" multiple>
                            </div>

                            <button type="submit" class="btn" id="uploadImageBtn" disabled>
                                <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>
                            </button>

                            <div id="imageProgressContainer" style="display: none;">
                                <div id="imageProgressBar">
                                    <span id="imageProgressText">0%</span>
                                </div>
                            </div>
                        </form>
                    </div>
                    <button class="btnmanage" id="manageBtn">
                        <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∞–º–∏</span>
                    </button>
                </div>

                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Å—ã–ª–∫–∞–º–∏ - –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–∞, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                <div id="manageCard" style="display: none;">
                    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∞–º–∏</h2>
                    <div class="manage-card-content">
                        <div class="selector-group">
                            <label class="selector-label" for="albumSelector">–í—ã–±–µ—Ä–∏—Ç–µ –∞–ª—å–±–æ–º:</label>
                            <select id="albumSelector" class="selector">
                                <option value="">-- –ó–∞–≥—Ä—É–∑–∫–∞ –∞–ª—å–±–æ–º–æ–≤ --</option>
                            </select>
                        </div>
                        <div class="selector-group">
                            <label class="selector-label" for="articleSelector">–í—ã–±–µ—Ä–∏—Ç–µ –∞—Ä—Ç–∏–∫—É–ª:</label>
                            <select id="articleSelector" class="selector" disabled>
                                <option value="">-- –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∞–ª—å–±–æ–º --</option>
                            </select>
                        </div>

                        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è - –¢–û–õ–¨–ö–û –î–õ–Ø –¢–ï–•, –£ –ö–û–ì–û –ï–°–¢–¨ –ü–†–ê–í–ê –ù–ê –£–ü–†–ê–í–õ–ï–ù–ò–ï -->
                        {% if has_permission(Permissions.MANAGE_ALBUMS) or has_permission(Permissions.MANAGE_ARTICLES) %}
                        <div id="deleteButtonsContainer" class="delete-buttons-container">
                            <!-- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                        {% endif %}

                        {% if has_permission(Permissions.EXPORT_DATA) %}
                        <div class="selector-group">
                            <button class="btn" id="createXlsxBtn" disabled>
                                <span>üìä –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç XLSX</span>
                            </button>
                        </div>
                        <div class="selector-group">
                            <button class="btn" id="createCSVBtn" disabled>
                                <span>üìä –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π CSV</span>
                            </button>
                        </div>
                        {% endif %}
                    </div>
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –¢–û–õ–¨–ö–û –î–õ–Ø –¢–ï–•, –£ –ö–û–ì–û –ï–°–¢–¨ –ü–†–ê–í–û SYNC_DATABASE -->
                    {% if has_permission(Permissions.SYNC_DATABASE) %}
                    <div class="stats-card" id="statsCard">
                        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</h3>
                        <div class="stats-content">
                            <div class="stat-item">
                                <span class="stat-label">–•—Ä–∞–Ω–∏–ª–∏—â–µ:</span>
                                <div class="disk-bar">
                                    <div class="disk-bar-fill" id="diskBarFill"></div>
                                </div>
                                <div class="stat-value" id="diskUsage" style="width: 100%; text-align: center; margin-top: 5px; font-size: 0.8rem;">
                                    –ó–∞–≥—Ä—É–∑–∫–∞...
                                </div>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤:</span>
                                <span class="stat-value" id="totalFiles">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">–í—Å–µ–≥–æ –∞–ª—å–±–æ–º–æ–≤:</span>
                                <span class="stat-value" id="totalAlbums">0</span>
                            </div>
                        </div>
                        <button class="btn btn-refresh" id="refreshStatsBtn" style="margin-top: 10px; width: 100%;">
                            üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                    {% endif %}

                    <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥ –∫ –∑–∞–≥—Ä—É–∑–∫–µ" —Å–∫—Ä—ã—Ç–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ –ø—Ä–∞–≤–∞ UPLOAD_ZIP -->
                    <button class="btnmanage" id="backToUploadBtn"
                        {% if not has_permission(Permissions.UPLOAD_ZIP) %}style="display: none;"{% endif %}>
                        <span>–ù–∞–∑–∞–¥ –∫ –∑–∞–≥—Ä—É–∑–∫–µ</span>
                    </button>
                </div>
            </div>
            <div class="column-right">
                <div class="card links-section">
                    <h2>
                        <span id="currentAlbumTitle">
                            {% if has_permission(Permissions.VIEW_FILES) %}
                                –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                            {% else %}
                                ‚ùå –ù–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∞–π–ª–æ–≤
                            {% endif %}
                        </span>
                    </h2>
                    <ul id="linkList" class="link-list">
                        {% if has_permission(Permissions.VIEW_FILES) %}
                            {% if not has_permission(Permissions.UPLOAD_ZIP) %}
                                <div class="empty-state">–í—ã–±–µ—Ä–∏—Ç–µ –∞–ª—å–±–æ–º –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</div>
                            {% else %}
                                <div class="empty-state">–ó–∞–≥—Ä—É–∑–∏—Ç–µ ZIP-–∞—Ä—Ö–∏–≤, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                            {% endif %}
                        {% else %}
                            <div class="empty-state" style="color: #e74c3c;">
                                ‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∞–π–ª–æ–≤. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.
                            </div>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è XLSX -->
    <div id="xlsxModal" class="xlsx-modal">
        <div class="xlsx-modal-content">
            <div class="xlsx-modal-header">
                <h3>üìä –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ XLSX</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="xlsx-modal-body">
                <div class="form-group">
                    <label class="form-label" for="xlsxTemplateSelect">–®–∞–±–ª–æ–Ω —ç–∫—Å–ø–æ—Ä—Ç–∞:</label>
                    <select id="xlsxTemplateSelect" class="form-select">
                        <option value="in_row">–í —Å—Ç—Ä–æ–∫—É (–∫–∞–∂–¥–∞—è —Å—Å—ã–ª–∫–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —è—á–µ–π–∫–µ)</option>
                        <option value="in_cell">–í —è—á–µ–π–∫—É (–≤—Å–µ —Å—Å—ã–ª–∫–∏ –≤ –æ–¥–Ω–æ–π —è—á–µ–π–∫–µ)</option>
                    </select>
                </div>

                <div class="form-group" id="separatorGroup" style="display: none;">
                    <label class="form-label" for="separatorSelect">–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å —Å—Å—ã–ª–æ–∫:</label>
                    <select id="separatorSelect" class="form-select">
                        <option value="comma">–ó–∞–ø—è—Ç–∞—è —Å –ø—Ä–æ–±–µ–ª–æ–º</option>
                        <option value="newline">–ü–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏</option>
                    </select>
                </div>
            </div>
            <div class="xlsx-modal-footer">
                <button class="btn-secondary" id="cancelXlsxBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-primary" id="generateXlsxBtn">–°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</button>
            </div>
        </div>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">–û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—Ä—Ö–∏–≤–∞...</div>
        <div class="loading-details">–†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º —Ñ–∞–π–ª—ã –∏ —Å–æ–∑–¥–∞–µ–º –ø—Ä–µ–≤—å—é. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.</div>
    </div>

    <script src="{{ url_for('static', filename='index.js') }}"></script>
</body>
</html>
