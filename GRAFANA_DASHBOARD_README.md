# Grafana Dashboard для приложения

## Обзор

Этот документ описывает дашборд Grafana, созданный для мониторинга приложения с метриками Prometheus. Дашборд включает в себя ключевые метрики производительности и состояния приложения.

## Метрики, отображаемые в дашборде

### 1. Сводная информация (Overview)
- **Albums**: Количество альбомов в системе
- **Articles**: Количество артикулов в системе
- **Files**: Общее количество файлов в системе

### 2. Дисковое пространство
- **Disk Usage**: Процент использования дискового пространства для разных точек монтирования (отображается в виде гейджа с цветовой индикацией)
- **Disk Space Usage**: График использования дискового пространства (всего, использовано, свободно) в байтах для точки монтирования `/app/images`
- **Disk Space Usage Alternative Paths**: График использования дискового пространства для точки монтирования `/images`
- **Root Disk Space Usage**: График использования дискового пространства для корневой файловой системы `/`

### 3. База данных
- **Database Size**: Размер базы данных в байтах

### 4. Время работы приложения
- **Application Uptime**: Время работы приложения в секундах

### 5. HTTP-запросы
- **HTTP Request Rate**: Скорость HTTP-запросов по методам (в запросах в секунду)
- **HTTP Status Codes**: Распределение HTTP-запросов по кодам состояния
- **HTTP Request Duration (95th percentile)**: 95-й перцентиль времени выполнения запросов
- **HTTP Request Duration Histogram**: Гистограмма распределения времени выполнения запросов

### 6. Подключения
- **Active Connections**: Количество активных подключений к приложению

### 7. Количество сущностей со временем
- **Album, Article, and File Counts Over Time**: Изменение количества альбомов, артикулов и файлов со временем

## Установка и настройка

### 1. Установка Grafana
Если Grafana еще не установлена:
```bash
# Для Ubuntu/Debian
sudo apt-get install -y grafana

# Или через Docker
docker run -d -p 3000:3000 --name=grafana grafana/grafana
```

### 2. Настройка источника данных Prometheus
1. Откройте веб-интерфейс Grafana (по умолчанию http://localhost:3000)
2. Перейдите в Configuration → Data Sources
3. Нажмите "Add data source"
4. Выберите "Prometheus"
5. Укажите URL Prometheus (например, http://prometheus:9090)
6. Нажмите "Save & Test"

### 3. Импорт дашборда
1. В Grafana перейдите на главную страницу
2. Нажмите "+" в левой панели и выберите "Import"
3. Выберите файл `grafana_dashboard.json` или вставьте его содержимое в поле "Import via panel json"
4. Нажмите "Load"
5. Настройте имя дашборда и выберите источник данных Prometheus
6. Нажмите "Import"

## Использование дашборда

### Мониторинг производительности
- Следите за HTTP Request Rate и HTTP Request Duration для выявления возможных проблем с производительностью
- Используйте HTTP Status Codes для отслеживания ошибок в приложении

### Мониторинг ресурсов
- Регулярно проверяйте использование дискового пространства
- Следите за размером базы данных для планирования очистки или масштабирования

### Мониторинг состояния приложения
- Проверяйте время работы приложения (Uptime) для оценки стабильности
- Следите за количеством альбомов, артикулов и файлов для анализа роста системы

## Настройка оповещений

Для каждого панели в дашборде можно настроить оповещения:
1. Откройте нужную панель
2. Перейдите во вкладку "Alert"
3. Нажмите "Create Alert"
4. Настройте условия срабатывания и уведомления

## Устранение неполадок

### Дашборд не отображает данные
- Проверьте, что Prometheus правильно собирает метрики с приложения
- Убедитесь, что endpoint `/metrics` доступен и возвращает данные в формате Prometheus
- Проверьте настройки источника данных в Grafana

### Некоторые метрики отсутствуют
- Убедитесь, что все метрики правильно определены в приложении
- Проверьте, что метрики обновляются регулярно

## Дополнительная информация

Для получения более подробной информации о метриках Prometheus, реализованных в приложении, смотрите `PROMETHEUS_METRICS.md`.