# Система хостинга изображений (PicHosting)

## Описание

PicHosting — это современное веб-приложение для хостинга и управления изображениями, разработанное на Python с использованием фреймворка Flask. Приложение предоставляет функциональность для загрузки, каталогизации, просмотра и экспорта изображений с поддержкой аутентификации и ролевой системы доступа.

## Архитектура


Приложение построено по модульной архитектуре и включает в себя следующие основные компоненты:

- **Веб-интерфейс**: Flask-приложение с пользовательским интерфейсом
- **База данных**: PostgreSQL для хранения метаданных файлов и информации о пользователях
- **Система аутентификации**: Интеграция с Keycloak через OAuth2/OpenID Connect
- **Слой хранения**: Файловая система для хранения изображений и миниатюр
- **Прокси-сервер**: Nginx для обработки HTTP-запросов и отдачи статических файлов

## Основные возможности

### Управление изображениями
- Загрузка ZIP-архивов с изображениями (поддержка групповой загрузки)
- Загрузка отдельных изображений
- Автоматическое создание миниатюр различных размеров
- Каталогизация изображений по альбомам и артикулам
- Просмотр и фильтрация по категориям

### Аутентификация и авторизация
- Интеграция с Keycloak для централизованной аутентификации
- Три уровня доступа:
  - `appviewer`: Просмотр альбомов и изображений, экспорт данных
  - `appuser`: Просмотр + загрузка файлов + экспорт данных
  - `appadmin`: Полный доступ + администрирование

### Администрирование
- Управление альбомами и артикулами
- Статистика использования дискового пространства
- Логирование действий пользователей
- Синхронизация базы данных с файловой системой
- Информация о системе и базе данных

### Экспорт данных
- Генерация XLSX-отчетов с ссылками на изображения
- Экспорт данных в CSV-формате
- Настраиваемые параметры экспорта

## Технические характеристики

### Технологии
- **Backend**: Python 3.11+, Flask 2.x
- **База данных**: PostgreSQL 13+
- **Веб-сервер**: Nginx
- **Контейнеризация**: Docker, Docker Compose
- **Аутентификация**: OAuth2/OpenID Connect (Keycloak)

### Зависимости
Основные зависимости определены в `requirements.txt`:
- Flask и сопутствующие расширения
- Authlib для OAuth2 интеграции
- Pillow для обработки изображений
- Psycopg2 для работы с PostgreSQL
- Gunicorn для запуска приложения

## Установка и запуск

### Подготовка

1. Клонируйте репозиторий
2. Создайте файл `.env` на основе `env.example` и укажите необходимые переменные окружения
3. Настройте Keycloak для OAuth2 аутентификации

### Запуск с Docker

```bash
# Сборка и запуск контейнеров
docker-compose up -d

# При первом запуске может потребоваться подождать инициализации базы данных
```

### Конфигурация

Ключевые переменные окружения:

- `DOMAIN`: Доменное имя приложения
- `POSTGRES_*`: Параметры подключения к базе данных
- `OAUTH_*`: Параметры аутентификации Keycloak
- `FLASK_SECRET_KEY`: Секретный ключ Flask-приложения

## API

Приложение предоставляет REST API для управления изображениями:

- `/api/albums` — список альбомов
- `/api/articles/<album_name>` — список артикулов в альбоме
- `/api/files/<album_name>[/<article_name>]` — файлы в альбоме или артикуле
- `/api/thumbnails/<album_name>[/<article_name>]` — информация о файлах с миниатюрами
- `/api/upload` — загрузка ZIP-архива
- `/api/export-xlsx` и `/api/export-csv` — экспорт данных
- `/api/sync` — синхронизация файловой системы с базой данных

## Безопасность

- Аутентификация через OAuth2/OpenID Connect
- Ролевая система с тремя уровнями доступа
- Защита от несанкционированного доступа к файлам
- Логирование всех действий пользователей
- Проверка типов файлов при загрузке

## Масштабируемость

- Поддержка многопоточной обработки ZIP-архивов
- Оптимизированные SQL-запросы с индексами
- Эффективное кэширование миниатюр
- Возможность горизонтального масштабирования

## Мониторинг и статистика

- Страница статистики с информацией о дисковом пространстве
- Административная панель с информацией о базе данных
- Логирование действий пользователей
- Статистика синхронизации файловой системы

## Лицензия

Проект распространяется по лицензии MIT. Подробности в файле LICENSE.